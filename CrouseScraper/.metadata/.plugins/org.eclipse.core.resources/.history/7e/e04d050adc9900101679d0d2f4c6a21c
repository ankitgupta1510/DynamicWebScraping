package main;



import models.Policy;
import scrapers.BikeInsuranceScraper;
import scrapers.CarInsuranceScraper;
import scrapers.HealthInsuranceScraper;
import scrapers.InsuranceScraper;
import scrapers.TermInsuranceScraper;
import services.ExcelWriterService;

import java.util.ArrayList;
import java.util.List;
import java.util.stream.Collectors;

public class Main {

    public static void main(String[] args) {
        
        List<InsuranceScraper> scrapers = new ArrayList<>();
        scrapers.add(new HealthInsuranceScraper());
        scrapers.add(new TermInsuranceScraper());
       
         scrapers.add(new BikeInsuranceScraper());
        
        // 2. Excel service 
        String fileName = "InsuranceData.xlsx";
        ExcelWriterService excelWriter = new ExcelWriterService(fileName);

        // 3. Har scraper ko ek-ek karke chalayein aur data Excel mein likhein.
        for (InsuranceScraper scraper : scrapers) {
            List<? extends Policy> policies = scraper.scrape();
            if (policies != null && !policies.isEmpty()) {
                excelWriter.createSheetsWithHeader(scraper.getSheetName(), scraper.getHeaders());
                List<String[]> dataForExcel = policies.stream().map(Policy::toArray).collect(Collectors.toList());
                excelWriter.writeDataToSheet(scraper.getSheetName(), dataForExcel);
            }
        }
        
        // FUTURE: Khali sheets banane ke liye
        excelWriter.createSheetsWithHeader("Car Insurance");
        excelWriter.createSheetsWithHeader("Bike Insurance");
        
        // 4. Workbook ko save karein.
        try {
            excelWriter.saveWorkbook();
            System.out.println("\n✅ Success! All data has been written to " + fileName);
        } catch (Exception e) {
            System.err.println("\n❌ Error writing to Excel file: " + e.getMessage());
        }
    }
}