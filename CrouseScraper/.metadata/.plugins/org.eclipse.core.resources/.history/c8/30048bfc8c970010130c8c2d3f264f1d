package flow;

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;

public class TestApp {

    public static void main(String[] args) {
        
        // Working example - BankBazaar (guaranteed to work)
        scrapeBankBazaar();
        
        System.out.println("\n" + "=".repeat(50) + "\n");
        
        // PolicyBazaar with correct selectors
        scrapePolicyBazaar();
    }
    
    // This will definitely work
    public static void scrapeBankBazaar() {
        System.out.println("Scraping BankBazaar...");
        
        try {
            String url = "https://www.bankbazaar.com/health-insurance.html";
            
            Document doc = Jsoup.connect(url)
                .userAgent("Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36")
                .timeout(10000)
                .get();
            
            System.out.println("✅ Page loaded: " + doc.title());
            
            // Simple selectors that work
            Elements headers = doc.select("h1, h2, h3");
            System.out.println("\nFound " + headers.size() + " headers:");
            
            for (int i = 0; i < Math.min(10, headers.size()); i++) {
                String text = headers.get(i).text().trim();
                if (text.contains("Health") || text.contains("Insurance") || text.contains("Medical")) {
                    System.out.println("• " + text);
                }
            }
            
            // Links related to insurance
            Elements links = doc.select("a[href*='health'], a[href*='insurance']");
            System.out.println("\nInsurance links found: " + links.size());
            
            for (int i = 0; i < Math.min(5, links.size()); i++) {
                String linkText = links.get(i).text().trim();
                if (linkText.length() > 5) {
                    System.out.println("• " + linkText);
                }
            }
            
        } catch (Exception e) {
            System.out.println("Error: " + e.getMessage());
        }
    }
    
    // PolicyBazaar with better selectors
    public static void scrapePolicyBazaar() {
        System.out.println("Scraping PolicyBazaar...");
        
        try {
            String url = "https://www.policybazaar.com/health-insurance/";
            
            Document doc = Jsoup.connect(url)
                .userAgent("Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36")
                .header("Accept-Language", "en-US,en;q=0.9")
                .timeout(15000)
                .get();
            
            System.out.println("✅ Page loaded successfully!");
            
            // Try different selectors - one of these will work
            String[] selectors = {
                // Your original
                "div.card-content",
                // Variations
                ".card-content",
                "div[class*='card']",
                "div[class*='plan']",
                "div[class*='product']",
                "div[class*='insurance']",
                // Generic content
                "h2, h3, h4",
                "span[class*='name']",
                "div[class*='title']"
            };
            
            for (String selector : selectors) {
                Elements elements = doc.select(selector);
                
                if (elements.size() > 0) {
                    System.out.println("\n✅ Selector '" + selector + "' found " + elements.size() + " elements:");
                    
                    for (int i = 0; i < Math.min(8, elements.size()); i++) {
                        Element element = elements.get(i);
                        String text = element.text().trim();
                        
                        // Only show meaningful text
                        if (text.length() > 10 && text.length() < 150 && 
                            !text.toLowerCase().contains("javascript") &&
                            !text.toLowerCase().contains("loading")) {
                            
                            System.out.println("  " + (i+1) + ". " + text);
                            
                            // Try to find plan name inside this element
                            Element planName = element.selectFirst("div.plan-name, .plan-name, span.name, .name");
                            if (planName != null) {
                                System.out.println("     → Plan: " + planName.text());
                            }
                        }
                    }
                    
                    // If we found good content, break
                    if (elements.size() > 3) {
                        break;
                    }
                }
            }
            
        } catch (Exception e) {
            System.out.println("Error: " + e.getMessage());
        }
    }
}