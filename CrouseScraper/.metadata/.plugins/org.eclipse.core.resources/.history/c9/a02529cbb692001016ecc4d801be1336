package CollegeScraper;

import org.jsoup.*;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;
import java.io.FileWriter;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

public class basic {
    
    static class College {
        String name;
        String fees;
        String location;
        String type;
        String ranking;
        
        College(String name, String fees, String location, String type, String ranking) {
            this.name = name;
            this.fees = fees;
            this.location = location;
            this.type = type;
            this.ranking = ranking;
        }
        
        @Override
        public String toString() {
            return String.format("Name: %s | Fees: %s | Location: %s | Type: %s | Ranking: %s", 
                               name, fees, location, type, ranking);
        }
        
        public String toCsv() {
            return String.format("\"%s\",\"%s\",\"%s\",\"%s\",\"%s\"", 
                               name.replace("\"", "\"\""), 
                               fees.replace("\"", "\"\""), 
                               location.replace("\"", "\"\""), 
                               type.replace("\"", "\"\""), 
                               ranking.replace("\"", "\"\""));
        }
    }
    
    public static void main(String[] args) throws IOException {
        List<College> allColleges = new ArrayList<>();
        int pageNum = 1;
        int maxPages = 10; // Adjust based on how many pages you want to scrape
        
        System.out.println("Starting Career360 college scraping...");
        
        while (pageNum <= maxPages) {
            try {
                String url = "https://bschool.careers360.com/colleges/ranking";
                if (pageNum > 1) {
                    url += "?page=" + pageNum;
                }
                
                System.out.println("Scraping page " + pageNum + ": " + url);
                
                Document doc = Jsoup.connect(url)
                        .userAgent("Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36")
                        .header("Accept", "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8")
                        .header("Accept-Language", "en-US,en;q=0.5")
                        .header("Accept-Encoding", "gzip, deflate")
                        .header("Connection", "keep-alive")
                        .timeout(10000)
                        .get();
                
                // Extract college cards/containers
                Elements collegeContainers = doc.select("div.facet-tuple-inner-container");
                
                if (collegeContainers.isEmpty()) {
                    System.out.println("No more colleges found on page " + pageNum);
                    break;
                }
                
                for (Element container : collegeContainers) {
                    try {
                        // Extract college name
                        Element nameElement = container.selectFirst("h3 a, h3");
                        String name = nameElement != null ? nameElement.text().trim() : "N/A";
                        
                        // Extract ranking
                        Element rankElement = container.selectFirst(".ranking_number, .rank");
                        String ranking = rankElement != null ? rankElement.text().trim() : "N/A";
                        
                        // Extract fees information
                        String fees = "N/A";
                        Elements feeElements = container.select("li");
                        for (Element feeElement : feeElements) {
                            String text = feeElement.text().toLowerCase();
                            if (text.contains("fee") || text.contains("â‚¹") || text.contains("rs") || text.contains("lakh")) {
                                fees = feeElement.text().trim();
                                break;
                            }
                        }
                        
                        // Extract location
                        String location = "N/A";
                        Elements locationElements = container.select("li, .location, .address");
                        for (Element locElement : locationElements) {
                            String text = locElement.text();
                            // Look for common location indicators
                            if (text.matches(".*\\b(Mumbai|Delhi|Bangalore|Chennai|Kolkata|Pune|Hyderabad|Ahmedabad|Jaipur|Lucknow|Kanpur|Nagpur|Indore|Thane|Bhopal|Visakhapatnam|Pimpri|Patna|Vadodara|Ghaziabad|Ludhiana|Agra|Nashik|Faridabad|Meerut|Rajkot|Kalyan|Vasai|Varanasi|Srinagar|Aurangabad|Dhanbad|Amritsar|Navi Mumbai|Allahabad|Ranchi|Howrah|Coimbatore|Jabalpur|Gwalior|Vijayawada|Jodhpur|Madurai|Raipur|Kota|Guwahati|Chandigarh|Solapur|Hubballi|Tiruchirappalli|Bareilly|Mysore|Tiruppur|Gurgaon|Aligarh|Jalandhar|Bhubaneswar|Salem|Mira-Bhayandar|Warangal|Guntur|Bhiwandi|Saharanpur|Gorakhpur|Bikaner|Amravati|Noida|Jamshedpur|Bhilai|Cuttack|Firozabad|Kochi|Nellore|Bhavnagar|Dehradun|Durgapur|Asansol|Rourkela|Nanded|Kolhapur|Ajmer|Akola|Gulbarga|Jamnagar|Ujjain|Loni|Siliguri|Jhansi|Ulhasnagar|Jammu|Sangli-Miraj|Mangalore|Erode|Belgaum|Ambattur|Tirunelveli|Malegaon|Gaya|Jalgaon|Udaipur|Maheshtala)\\b.*")) {
                                location = text.trim();
                                break;
                            }
                        }
                        
                        // Extract college type
                        String type = "N/A";
                        Elements typeElements = container.select("li, .college-type, .institution-type");
                        for (Element typeElement : typeElements) {
                            String text = typeElement.text().toLowerCase();
                            if (text.contains("private") || text.contains("government") || text.contains("public") || 
                                text.contains("autonomous") || text.contains("deemed") || text.contains("university")) {
                                type = typeElement.text().trim();
                                break;
                            }
                        }
                        
                        // If location is still N/A, try to extract from name or other elements
                        if ("N/A".equals(location)) {
                            Elements allElements = container.select("*");
                            for (Element element : allElements) {
                                String text = element.ownText();
                                if (text.matches(".*\\b(Mumbai|Delhi|Bangalore|Chennai|Kolkata|Pune|Hyderabad|Ahmedabad|Jaipur|Lucknow|Kanpur|Nagpur|Indore|Thane|Bhopal|Visakhapatnam|Pimpri|Patna|Vadodara|Ghaziabad|Ludhiana|Agra|Nashik|Faridabad|Meerut|Rajkot|Kalyan|Vasai|Varanasi|Srinagar|Aurangabad|Dhanbad|Amritsar|Navi Mumbai|Allahabad|Ranchi|Howrah|Coimbatore|Jabalpur|Gwalior|Vijayawada|Jodhpur|Madurai|Raipur|Kota|Guwahati|Chandigarh|Solapur|Hubballi|Tiruchirappalli|Bareilly|Mysore|Tiruppur|Gurgaon|Aligarh|Jalandhar|Bhubaneswar|Salem|Mira-Bhayandar|Warangal|Guntur|Bhiwandi|Saharanpur|Gorakhpur|Bikaner|Amravati|Noida|Jamshedpur|Bhilai|Cuttack|Firozabad|Kochi|Nellore|Bhavnagar|Dehradun|Durgapur|Asansol|Rourkela|Nanded|Kolhapur|Ajmer|Akola|Gulbarga|Jamnagar|Ujjain|Loni|Siliguri|Jhansi|Ulhasnagar|Jammu|Sangli-Miraj|Mangalore|Erode|Belgaum|Ambattur|Tirunelveli|Malegaon|Gaya|Jalgaon|Udaipur|Maheshtala)\\b.*")) {
                                    location = text.trim();
                                    break;
                                }
                            }
                        }
                        
                        College college = new College(name, fees, location, type, ranking);
                        allColleges.add(college);
                        
                    } catch (Exception e) {
                        System.err.println("Error processing college container: " + e.getMessage());
                    }
                }
                
                System.out.println("Found " + collegeContainers.size() + " colleges on page " + pageNum);
                
                // Add delay between requests to be respectful
                Thread.sleep(2000);
                pageNum++;
                
            } catch (IOException e) {
                System.err.println("Error accessing page " + pageNum + ": " + e.getMessage());
                break;
            } catch (InterruptedException e) {
                System.err.println("Thread interrupted: " + e.getMessage());
                break;
            }
        }
        
        // Display results
        System.out.println("\n=== SCRAPED COLLEGES ===");
        System.out.println("Total colleges found: " + allColleges.size());
        System.out.println();
        
        for (int i = 0; i < Math.min(allColleges.size(), 20); i++) { // Show first 20
            System.out.println((i + 1) + ". " + allColleges.get(i));
        }
        
        if (allColleges.size() > 20) {
            System.out.println("... and " + (allColleges.size() - 20) + " more colleges");
        }
        
        // Save to CSV file
        try {
            saveToCSV(allColleges, "colleges_data.csv");
            System.out.println("\nData saved to colleges_data.csv");
        } catch (IOException e) {
            System.err.println("Error saving to CSV: " + e.getMessage());
        }
    }
    
    private static void saveToCSV(List<College> colleges, String filename) throws IOException {
        try (FileWriter writer = new FileWriter(filename)) {
            // Write header
            writer.write("Name,Fees,Location,Type,Ranking\n");
            
            // Write data
            for (College college : colleges) {
                writer.write(college.toCsv() + "\n");
            }
        }
    }
}