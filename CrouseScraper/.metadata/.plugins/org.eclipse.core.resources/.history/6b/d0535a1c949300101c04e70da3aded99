package CollegeScraper;

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;
import java.io.IOException;
import java.util.Map;

public class MainApp {
    public static void main(String[] args) throws IOException {
    	
    	Map<String ,String> urlMap = BrowseByStream.streamScraper();
    	
    	for(String urlString :urlMap.values()) {
    		
    
        boolean hasData = true;
        int pageNum=1;

        while(hasData) {
        	
        	String url ="";
        	
        	if(urlString.equals("https://studyabroad.careers360.com")) {
        		 url = urlString+"/colleges-abroad-allpg"+"?page="+pageNum;
        	}
        	else if (urlString.equals("https://finance.careers360.com")) {
//        		System.out.println(urlString);
        		url = urlString+"/colleges/list-of-commerce-colleges-in-india" + "?page="+pageNum;
        		
        	}else if(urlString.equals("https://hospitality.careers360.com")) {
        		url = urlString+"/colleges/list-of-hospitality-tourism-colleges-in-india" + "?page="+pageNum;
        		System.out.println("mai faat rha hu hospitalitty");
        		
        	}else if(urlString.equals("https://it.careers360.com")) {
        		
        		url = urlString+"/colleges/list-of-bca-mca-colleges-in-india" + "?page="+pageNum;
        		System.out.println("mai faat rha hu it");
        		
        	}else if(urlString.equals("https://media.careers360.com")) {
        		url = urlString + "/colleges/list-of-media-journalism-colleges-in-india"  + "?page="+pageNum;
        		
        	}
        	else {
        		 url = urlString+"/colleges/ranking"+"?page="+pageNum;
        	}
        	
        
        
        
        Document doc = Jsoup.connect(url)
                .userAgent("Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36")
                
                .get();
        
        
        Elements collegeCards = doc.select("div.card_block");
        if (collegeCards.size() == 0) {
            hasData = false;
            System.out.println("No more data found. Ending pagination.");
            break;
        }
        

      System.out.println("Found " + collegeCards.size() + " colleges:");
        if(pageNum==1)hasData=false;
        
        for(Element card: collegeCards) {
        	String collegeNameSelector ="";
        	
        	if(url.equals(urlString+"/colleges/list-of-bca-mca-colleges-in-india" + "?page="+pageNum) || url.equals("https://hospitality.careers360.com") || url.equals("https://media.careers360.com")) {
        		collegeNameSelector = card.select("h3.college_name").text();
        		System.out.println(collegeNameSelector);
        	}else {
        		collegeNameSelector = card.select("h3.college_name_heading").text();
        		
        		
        	}
//        	collegeNameSelector = card.select("h3.college_name_heading").text();
        	 

            String fees = card.select("li.college-fees-text").text();
            
            String ownership = card.select("#college-list > div > div > div.facet-tuple-inner-container > div.left_side_tupple > div.tupple_top_block > div.tupple_right_block.d-none.d-lg-block > div > span:nth-child(2) > p.college-rank-rating").text();
//            Elements collegeOwnership = doc.select(".tupple_right_block .college-rank-rating");
            
            String location = collegeNameSelector.substring(collegeNameSelector.lastIndexOf(" ") + 1);

            System.out.println("College: " + collegeNameSelector +
                    " || " + fees +
                    " || Ownership: " + ownership +
                    " || Location: " + location);
        }
        	
        }
        
        pageNum++;
        try {
			Thread.sleep(1000);
		} catch (InterruptedException e) {
			
			e.printStackTrace();
		}
        
    	}
    }
}
